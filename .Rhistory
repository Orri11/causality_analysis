mean(1,2,3)
mean(c(1,2,3))
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
setwd('/home/RDC/shaharor/Schreibtisch/causality_analysis')
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
#extract the predictions
preds1 <- as.data.frame(t(ascm1$y0hat[[1]]))
colnames(preds1) <- sub("V","",colnames(preds1))
preds_treated1 <- as.matrix(preds1[(len-pred_len + 1):len,colnames(preds1) %in% treated_indices])
preds_control1 <- as.matrix(preds1[(len-pred_len + 1):len,!colnames(preds1) %in% treated_indices])
preds2 <- as.data.frame(t(ascm2$y0hat[[1]]))
colnames(preds2) <- sub("V","",colnames(preds1))
preds_treated2 <- as.matrix(preds2[(len-pred_len + 1):len,colnames(preds2) %in% treated_indices])
preds_control2 <- as.matrix(preds2[(len-pred_len + 1):len,!colnames(preds2) %in% treated_indices])
preds = cbind(preds1,preds2)
counterfactuals_path = paste0(data_folder,'_true_counterfactual.csv')
counterfactuals = read.csv((counterfactuals_path))
colnames(counterfactuals) <- sub("X","",colnames(counterfactuals))
colnames(counterfactuals) <- as.numeric(colnames(counterfactuals)) + 1
counterfactuals1 = counterfactuals[,1:150]
counterfactuals2 = counterfactuals[,151:300]
trues1 <- counterfactuals1[(len-pred_len + 1):len, ]
trues_treated1 <- as.matrix(trues1[,colnames(trues1) %in% treated_indices])
trues_control1 <- as.matrix(trues1[,!colnames(trues1) %in% treated_indices])
trues2 <- counterfactuals2[(len-pred_len + 1):len, ]
trues_treated2 <- as.matrix(trues2[,colnames(trues2) %in% treated_indices])
trues_control2 <- as.matrix(trues2[,!colnames(trues2) %in% treated_indices])
df_A1 <- counterfactuals1[1:(len-pred_len), ]
df_A_treated1 <- as.matrix(df_A1[,colnames(trues1) %in% treated_indices])
df_A_control1 <- as.matrix(df_A1[,!colnames(trues1) %in% treated_indices])
df_A2 <- counterfactuals2[1:(len-pred_len), ]
df_A_treated1 <- as.matrix(df_A2[,colnames(trues2) %in% treated_indices])
df_A_control1 <- as.matrix(df_A2[,!colnames(trues2) %in% treated_indices])
mase_control1 = MASE(preds_control1,trues_control1,df_A_control1,seasonality_period)
smape_control1 = SMAPE(preds_control1,trues_control1)
mase_control2 = MASE(preds_control2,trues_control2,df_A_control2,seasonality_period)
smape_control2 = SMAPE(preds_control2,trues_control2)
df_A1 <- counterfactuals1[1:(len-pred_len), ]
df_A_treated1 <- as.matrix(df_A1[,colnames(trues1) %in% treated_indices])
df_A_control1 <- as.matrix(df_A1[,!colnames(trues1) %in% treated_indices])
df_A2 <- counterfactuals2[1:(len-pred_len), ]
df_A_treated2 <- as.matrix(df_A2[,colnames(trues2) %in% treated_indices])
df_A_control2 <- as.matrix(df_A2[,!colnames(trues2) %in% treated_indices])
mase_control1 = MASE(preds_control1,trues_control1,df_A_control1,seasonality_period)
smape_control1 = SMAPE(preds_control1,trues_control1)
mase_control2 = MASE(preds_control2,trues_control2,df_A_control2,seasonality_period)
View(counterfactuals1)
View(counterfactuals2)
sum(treated_indices>150)
sum(treated_indices<150)
sum(treated_indices<=150)
preds2 <- as.data.frame(t(ascm2$y0hat[[1]]))
colnames(preds2) <- sub("V","",colnames(preds2))
preds_treated2 <- as.matrix(preds2[(len-pred_len + 1):len,colnames(preds2) %in% treated_indices])
preds_control2 <- as.matrix(preds2[(len-pred_len + 1):len,!colnames(preds2) %in% treated_indices])
View(trues1)
View(df_raw1)
View(df_long1)
View(df_raw)
View(preds1)
View(trues1)
View(preds2)
?seq
colnames(preds2) <- seq(151,300,length.out=150)
preds_treated2 <- as.matrix(preds2[(len-pred_len + 1):len,colnames(preds2) %in% treated_indices])
preds_control2 <- as.matrix(preds2[(len-pred_len + 1):len,!colnames(preds2) %in% treated_indices])
preds = cbind(preds1,preds2)
counterfactuals_path = paste0(data_folder,'_true_counterfactual.csv')
counterfactuals = read.csv((counterfactuals_path))
colnames(counterfactuals) <- sub("X","",colnames(counterfactuals))
colnames(counterfactuals) <- as.numeric(colnames(counterfactuals)) + 1
counterfactuals1 = counterfactuals[,1:150]
counterfactuals2 = counterfactuals[,151:300]
trues1 <- counterfactuals1[(len-pred_len + 1):len, ]
trues_treated1 <- as.matrix(trues1[,colnames(trues1) %in% treated_indices])
trues_control1 <- as.matrix(trues1[,!colnames(trues1) %in% treated_indices])
trues2 <- counterfactuals2[(len-pred_len + 1):len, ]
trues_treated2 <- as.matrix(trues2[,colnames(trues2) %in% treated_indices])
trues_control2 <- as.matrix(trues2[,!colnames(trues2) %in% treated_indices])
df_A1 <- counterfactuals1[1:(len-pred_len), ]
df_A_treated1 <- as.matrix(df_A1[,colnames(trues1) %in% treated_indices])
df_A_control1 <- as.matrix(df_A1[,!colnames(trues1) %in% treated_indices])
df_A2 <- counterfactuals2[1:(len-pred_len), ]
df_A_treated2 <- as.matrix(df_A2[,colnames(trues2) %in% treated_indices])
df_A_control2 <- as.matrix(df_A2[,!colnames(trues2) %in% treated_indices])
mase_control1 = MASE(preds_control1,trues_control1,df_A_control1,seasonality_period)
smape_control1 = SMAPE(preds_control1,trues_control1)
mase_control2 = MASE(preds_control2,trues_control2,df_A_control2,seasonality_period)
smape_control2 = SMAPE(preds_control2,trues_control2)
mase_control = mean(c(mase_control1,mase_control2))
smape_control = mean(c(smape_control1,smape_control2))
metrics_control = list(mase = mase_control,smape = smape_control)
mase_treated1 = MASE(preds_treated1,trues_treated1,df_A_treated1,seasonality_period)
smape_treated1 = SMAPE(preds_treated1,trues_treated1)
mase_treated2 = MASE(preds_treated2,trues_treated2,df_A_treated2,seasonality_period)
smape_treated2 = SMAPE(preds_treated2,trues_treated2)
mase_treated = mean(c(mase_treated1,mase_treated2))
smape_treated = mean(c(smape_treated1,smape_treated2))
metrics_treated = list(mase = mase_treated,smape = smape_treated)
forecasts_path = paste0(results_path,'/forecasts/')
metrics_path = paste0(results_path,'/metrics/')
if (!file.exists(forecasts_path)) {
dir.create(forecasts_path, recursive = TRUE)
}
if (!file.exists(metrics_path)) {
dir.create(metrics_path, recursive = TRUE)
}
write.csv(preds, paste0(forecasts_path,dataset_name,"_predictions.csv"), row.names = FALSE)
cat("mase", metrics_control$mase, "\n","smape", metrics_control$smape,
file = paste0(metrics_path,dataset_name,"_metrics_control.txt"))
cat("mase", metrics_treated$mase, "\n","smape", metrics_treated$smape,
file = paste0(metrics_path,dataset_name,"_metrics_treated.txt"))
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
source("~/Schreibtisch/causality_analysis/src/models/ascm/ascm_sim.R", echo=TRUE)
